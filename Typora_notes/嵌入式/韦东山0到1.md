# 韦东山随记

[TOC]

## 环境配置



##编译

交叉编译app



编译内核

make 100ask_stm32mp157_pro_defconfig



编译设备树

make dtbs



编译内核模块

make ARCH=arm CROSS_COMPILE=arm-buildroot-linux-gnueabihf- modules -j8



安装内核模块

make ARCH=arm INSTALL_MOD_PATH=/home/stm32/nfs_rootfs INSTALL_MOD_STRIP=1 modules_install



编译过程

| 工具     | 源文件 | 输出文件    |
| -------- | ------ | ----------- |
| cc1      | .c     | .s 汇编文件 |
| as       | .s     | .o          |
| collect2 | all    | app         |

![image-20250708131636835](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/202507081316946.png)

![image-20250708110026405](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/202507081100759.png)



先编译不链接

最后一块儿链接

gcc -c -o main.o main.c

gcc -c -o sub.o sub.c

gcc -o test main.o sub.o





编译指定头文件为当前目录



<系统目录> “当前目录”

gcc -c -o main.o main.c -I ./ -v



静态库

```bash
ar crs libsub.a sub.o # 也可以多个.o 压缩成一个静态库，ar crs libsub.a sub1.o sub2.o
gcc -o test main.o libsub.a
```



链接

