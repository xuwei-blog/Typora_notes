# 江科大自化协C51

## 概述

[TOC]

## 常识

### 命名规则

![image-20230226221115941](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/image-20230226221115941.png)

## demo

### 独立按键

- 按键原理图

![image-20230317105323262](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/202303171053304.png)

- 按键的抖动

![image-20230317171629262](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/202303171716326.png)

- 程序

```C
#include <REGX52.H>
void Delay(unsigned int xms)		//@12.000MHz
{
	unsigned char i, j;
	while(xms--)
	{
		i = 12;
		j = 169;
		do
		{
			while (--j);
		} while (--i);
	}

}

void main()
{
	while(1)
	{
		if(P3_1 == 0)
		{
			Delay(20);	//消除抖动
			while(P3_1 == 0);
			Delay(20);
			P2_0 = ~P2_0;
		}
	}
}
```

### 数码管

- 区分共阴极和共阳极

![image-20230317180714189](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/202303171807245.png)

- 段码

数码管的数据位

- 原理图

![image-20230317183344110](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/202303171833155.png)

- 字符数组

> 数据的高位 对应 端口的高位，和大端存储没有关系
>
> 例如：
>
> ```
> //显示字符9
> abcdefg[dp] 对应为 1111 0110
> 端口最高位 - 最低位  0110 1111  ==》 6F
> ```

![image-20230321101532072](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/202303211015104.png)

#### 数码管程序

```C
unsigned char NixieTable[] = {0x3F,0x06,0x5B,0x4F,0x66,
							  0x6D,0x7D,0x07,0x7F,0x6F};

void Delay(unsigned int xms)		//@12.000MHz
{
	unsigned char i, j;
	while(xms--)
	{
		i = 2;
		j = 239;
		do
		{
			while (--j);
		} while (--i);
	}	
}

void Nixie(unsigned char Location,Number)
{
	switch(Location)
	{
		//38ÒëÂëÆ÷Ñ¡Ôñ
		case 1:P2_4 = 1;P2_3 = 1;P2_2 = 1;break;
		case 2:P2_4 = 1;P2_3 = 1;P2_2 = 0;break;
		case 3:P2_4 = 1;P2_3 = 0;P2_2 = 1;break;
		case 4:P2_4 = 1;P2_3 = 0;P2_2 = 0;break;
		case 5:P2_4 = 0;P2_3 = 1;P2_2 = 1;break;
		case 6:P2_4 = 0;P2_3 = 1;P2_2 = 0;break;
		case 7:P2_4 = 0;P2_3 = 0;P2_2 = 1;break;
		case 8:P2_4 = 0;P2_3 = 0;P2_2 = 0;break;		
	}
	P0 = NixieTable[Number];
    Delay(1);	//不延时会导致数码管很暗
    P0 = 0x00;	//清零
}
```

#### 数码管消影

> 显示流程：
>
> 位选 - 段选 -位选 - 段选 -位选 - 段选  .......
>
> 执行太快，会篡位
>
> 如何优化？
>
> 位选 - 段选 - 清零 - 位选 - 段选 - 清零 - 位选 - 段选 - 清零 .......

#### 数码管驱动方式

- 单片机直接扫描
  - 硬件设备简单，但会消耗大量的CPU时间
- 专用驱动芯片（例如TM1640）
  - 内部自带显存、扫描电路、单片机只需要告诉他显示什么就行

![image-20230321103229423](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/202303211032455.png)

### LCD1602

- 原理图

![image-20230321121951965](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/202303211219998.png)

- 模块化代码

![image-20230321122019956](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/202303211220016.png)

### 矩阵键盘

#### 扫描的概念

![image-20230321132150237](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/202303211321295.png)

- 原理图

![image-20230321211807119](https://typora-notes-codervv.oss-cn-shanghai.aliyuncs.com/img_for_typora/202303212118155.png)

#### 矩阵键盘代码

```C
unsigned char MatrixKey()
{
	unsigned char KeyNumber = 0;
	//按列扫描，因为按行扫描会有接口冲突
	P1 = 0xFF;	//清零
	P1_3 = 0;	//选择第一列，再判断第几行有数据
	if(P1_7 == 0){Delay(20);while(P1_7 == 0);Delay(20);KeyNumber = 1;}
	if(P1_6 == 0){Delay(20);while(P1_6 == 0);Delay(20);KeyNumber = 5;}
	if(P1_5 == 0){Delay(20);while(P1_5 == 0);Delay(20);KeyNumber = 9;}
	if(P1_4 == 0){Delay(20);while(P1_4 == 0);Delay(20);KeyNumber = 13;}
	
	P1 = 0xFF;
	P1_2 = 0;	//选择第二列
	if(P1_7 == 0){Delay(20);while(P1_7 == 0);Delay(20);KeyNumber = 2;}
	if(P1_6 == 0){Delay(20);while(P1_6 == 0);Delay(20);KeyNumber = 6;}
	if(P1_5 == 0){Delay(20);while(P1_5 == 0);Delay(20);KeyNumber = 10;}
	if(P1_4 == 0){Delay(20);while(P1_4 == 0);Delay(20);KeyNumber = 14;}
	
	P1 = 0xFF;
	P1_1 = 0;
	if(P1_7 == 0){Delay(20);while(P1_7 == 0);Delay(20);KeyNumber = 3;}
	if(P1_6 == 0){Delay(20);while(P1_6 == 0);Delay(20);KeyNumber = 7;}
	if(P1_5 == 0){Delay(20);while(P1_5 == 0);Delay(20);KeyNumber = 11;}
	if(P1_4 == 0){Delay(20);while(P1_4 == 0);Delay(20);KeyNumber = 15;}
	
	P1 = 0xFF;
	P1_0 = 0;
	if(P1_7 == 0){Delay(20);while(P1_7 == 0);Delay(20);KeyNumber = 4;}
	if(P1_6 == 0){Delay(20);while(P1_6 == 0);Delay(20);KeyNumber = 8;}
	if(P1_5 == 0){Delay(20);while(P1_5 == 0);Delay(20);KeyNumber = 12;}
	if(P1_4 == 0){Delay(20);while(P1_4 == 0);Delay(20);KeyNumber = 16;}
	
	return KeyNumber;
}
```

